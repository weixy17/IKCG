import os
import pdb
import sys 
sys.path.append('..') 
import numpy as np
import csv
import pandas as pd
from numpy import *
# orb_kp_path="/data/wxy/Pixel-Level-Cycle-Association-main/output/kps_resnet/vgg16_features_ORB16s8_fc6_10_0.5_15_0_20_0.25_25_0_30_0.25_rotate8_0.99_0.028_0.004_0.8_01norm_multiscale/"
# orb_kp_path="/data/wxy/Pixel-Level-Cycle-Association-main/output/kps_resnet/vgg16_features_ORB16s8_fc6_10_0.2_15_0.2_20_0.2_25_0.2_30_0.2_rotate8_0.99_0.028_0.004_0.8_01norm_multiscale/"
# orb_kp_path="/data/wxy/association/Maskflownet_association/kps/a0cAug30_3356_img2s_key_points_rotate16_0.98_0.95_corrected/"
# orb_kp_path="/data/wxy/Pixel-Level-Cycle-Association-main/output/kps_resnet/vgg16_features_ORB16s8_fc6_10_0.2_15_0.2_20_0.2_25_0.2_30_0.2_rotate8_0.99_0.028_0.004_0.8_01norm_same_pixels_multiscale/"
# orb_kp_path="/data/wxy/association/Maskflownet_association_1024/kps/LFS_SFG_multiscale_kps_1024/"
# orb_kp_path="/data/wxy/association/Maskflownet_association_1024/kps/LFS_SFG_multiscale_kps_1024_512_2_256_1_1024_1/"
# orb_kp_path="/data/wxy/Pixel-Level-Cycle-Association-main/output/kps_resnet/vgg16_features_ORB16s8_fc6_20_0.2_30_0.2_40_0.2_50_0.2_60_0.2_rotate8_0.99_0.028_0.004_0.8_01norm_same_pixels_multiscale_1024/"
# orb_kp_path="/data/wxy/Pixel-Level-Cycle-Association-main/output/kps_resnet/vgg16_features_ORB16s8_fc6_20_0.25_30_0_40_0.5_50_0_60_0.25_rotate8_0.985_0.028_0.004_0.81_01norm_same_pixels_multiscale_1024/"
# orb_kp_path="/data/wxy/association/Maskflownet_association_1024/kps/LFS_SFG_multiscale_kps_1024_with_ORB16s8_1024_0.972_0.92/"
# errors={'4':[1,3],'5':[5,10,12,17,22],'6':[0,1,3],'7':[0,3],'8':[15,20,25,65],'20':[32,39,],'41':[2],'47':[50],'51':[16,19,25,65],'52':[96,125],'86':[7],'88':[72],'103':[53],'105':[2,24,27],'106':[0,16],'111':[9],'121':[31],'122':[140],'124':[5,8],'129':[10,36,83],'138':[70],'139':[171,199],'140':[281],'141':[214],'142':[184,186,285],'156':[14,28],
        # '157':[47],'197':[22],'198':[8,16,26,37],'210':[18,33],'220':[323],'231':[22,12],'233':[94],'244':[4],'249':[0],'254':[0],'287':[9],'322':[2,3,5,8,11,14,16],'375':[39],'376':[14],'378':[9],'383':[19],'388':[2,31,39],'393':[3,50,57],'402':[44,65,72,75,87],'403':[7,46],'406':[12],'407':[29,39,89],'409':[62],'455':[0],'456':[1],
        # '457':[1,4],'453':[53,56,105],'461':[1,2,3],'470':[1,2,3],'472':[6,19],'480':[1,2]}
# errors={'4':[0],'5':[2],'7':[6],'8':[30,59],'13':[5,10],'19':[14],'84':[41],'87':[277],'111':[3],'120':[17,28],'123':[0],'124':[5,8],'129':[17],'140':[91],'142':[2,424],'156':[28],
        # '157':[14],'197':[10,11],'198':[8,9],'210':[18,21],'211':[10],'231':[1,13],'285':[0,1,6],'287':[1,2,3],'322':[2,6],'375':[61],'393':[27],'402':[13,18,22,77],'406':[5,54,59,70],'407':[17],'409':[30],'456':[0],
        # '457':[0],'453':[53,56,105],'461':[0],'472':[58],'480':[0]}
# errors={'7':[2,3,4],'19':[1],'173':[37],'210':[0],'244':[0],'322':[0,1,3,5],'372':[0],'397':[3],'402':[3],'456':[2],'457':[0],'472':[0],'480':[0]}
# errors={'5':[1],'6':[0],'8':[28,83],'13':[15],'33':[59],'51':[48,63],'120':[0,2,3,8,19,22,27],'121':[0,3,7,9,12,13,256,295],'123':[0,2,5,9,24,],'124':[1,3,4,12]
        # ,'129':[4,5,12,14,16,33,127],'168':[66],'197':[3,13,14,25],'198':[12,40],'209':[25],'231':[12],'239':[0],'249':[0],'264':[5],'279':[123,886]
        # ,'285':[5,10,11,14,22,27,30,33,38,52,53],'287':[7,17],'322':[3,13,18,23,24,26,28],'327':[2,6],'332':[19,38],'337':[12,40,41],'371':[21,25,105],'372':[4,6,24,26,30]
        # ,'373':[3,5],'383':[9,29],'389':[5,9,19,],'391':[60,139],'392':[22,24,43,60,61,78,83,85,93],'393':[66,77],'398':[5,28,],'401':[47],'402':[29,51,57,65,154]
        # ,'403':[0,9,29],'406':[2,5,7,11,12,14,17,22,24,41,63],'407':[278,322],'408':[3,4,13,19,112],'409':[43],'456':[1],'457':[3],'461':[3,4],'462':[67],'470':[0],'472':[11,19,33],'480':[0,2,3,6]}
# errors={'4':[5,6],'5':[7,15],'6':[3],'7':[3,4,6,7],'8':[0],'13':[6],'18':[0,1],'79':[0],'88':[128],'103':[0],'121':[304,305],'123':[21],'129':[180,179],'141':[400],'168':[0,2]
        # ,'173':[104],'197':[3],'231':[37],'244':[2,4],'249':[0],'254':[2],'285':[3,16,17,18],'322':[0,1,5,8],'327':[5,6],'337':[5],'378':[5],'391':[17],'392':[8],'402':[79,80,82]
        # ,'454':[2],'455':[0],'456':[4,5],'457':[0,1,11],'458':[0],'460':[0,1],'461':[1,3],'462':[10],'469':[0],'470':[2],'472':[0,1,51],'480':[2,7]}
# errors={'4':[3,4],'5':[18,19],'6':[6],'7':[2,3],'21':[0],'52':[188],'53':[146],'79':[0,1],'85':[0],'86':[79],'120':[28],'121':[318,319,320],'123':[16],'124':[0,11],'168':[2]
        # ,'184':[38],'208':[0],'231':[20],'244':[2],'254':[2,4],'285':[6,7],'287':[0],'317':[0,20,25],'322':[0,2,6,7,8,9],'327':[3,4,5],'337':[3],'391':[22],'402':[71]
        # ,'456':[7],'457':[0],'460':[1],'461':[2],'462':[3],'469':[0,1],'470':[0],'472':[0,1,34],'480':[1,3,4]}
# errors={'5':[34],'7':[2,3,4,6,8,14],'8':[0,18,21,23,25,34,38,41,42,44,46,49,52,120,134],'13':[6],'19':[13],'47':[75,102],'51':[47],'62':[2],'71':[2],'72':[5],'84':[6,13,17,50],'88':[23,24,43]
        # ,'93':[44],'102':[43,52,90],'103':[4,7],'120':[3,4,8,11,12,53],'121':[20,21,197],'123':[2,6,8,9,15,18,20,25,36,52],'124':[3,4,12],'129':[12,202,256],'138':[14,30,56,85,99,109,113,175]
        # ,'139':[4,5,8,71,78,119,137,228,240,304],'140':[18,31,445,564],'168':[147],'173':[3],'197':[1,2,6,7,9,12,18,19,24,25],'198':[5,18,37,39,40,54,67,72],'208':[0,3],'209':[3],'211':[8]
        # ,'212':[2,80],'214':[45,198],'231':[11],'244':[0,1,2,3,4,5,6,7,9,10,11,12,13,14],'249':[0,1,2,3],'254':[0],'285':[2,5,9,14,23,28,43,51,52,53,56,58,60,63,67,69,72,73],'287':[3,8,9,12,14,15,16]
        # ,'317':[15,20,33,39,46,54,58],'322':[29,35],'327':[2,13,15],'332':[29],'337':[45,52],'370':[83,109],'371':[85,186],'372':[10,17,19,73],'373':[6,13],'376':[1],'381':[161,178],'383':[4,8,39]
        # ,'384':[36],'386':[42,93,214],'388':[1,2,5,7,10],'389':[0,22],'391':[53,170,202],'392':[2,20,32,45,49,67,93,112,122,164,178,179,183,184,191],'393':[14,19,37,52],'395':[0,4,18,22],'397':[77,222,287]
        # ,'398':[19,27],'399':[0,2,5],'400':[48,104,105,124],'401':[77,101],'402':[1,13,47,52,70,131,164,175,203,210,218],'403':[4,8,10,14,22,23,32,123],'405':[15],'406':[2,14,48,119],'407':[4,39,111,135,707,701,602,475,376,356,190,179,173,160,141,102,62,37]
        # ,'408':[9,13,34,36,47,64,82],'409':[17],'456':[10],'457':[1,9],'458':[0],'461':[1],'462':[2,6,11,14,16,18,22,23,25,30,31,39,46,49,51,58,60,155,]}
# errors={'8':[10,25,30],'18':[46,65],'19':[0,8,26],'20':[1,10,12],'22':[10,11],'27':[2,12,74],'30':[5,10,14,17,23],'39':[7],'40':[27],'41':[32,38],'42':[2,7],'47':[0,1,3,5,8,9,11,16,18,19,21,23,27],'51':[12,14,20,21]
        # ,'52':[14],'61':[9,11],'62':[16],'70':[6],'79':[1,13],'84':[15,17],'85':[8],'86':[3],'87':[53],'88':[3,12,19],'93':[5,12,23,75],'102':[0,2,4],'103':[2,4,5],'104':[13],'106':[6,8]
        # ,'120':[1,2,8],'121':[27],'122':[27,28,41,44,52],'123':[1,2,3,7,10,18],'124':[0,2,4,5],'129':[1,2,3,5,18,23,25,29,43,44,47,54,57],'138':[5,8,14,22,41],'139':[5,22,24,28,26,34,37,40,60,73,86]
        # ,'140':[69,107],'147':[167],'156':[3,4,5],'157':[0,3,18],'163':[0,6,11],'168':[2,7,11,19,20,32],'197':[3,5,6],'198':[4,6,7,14,17,18,20],'199':[7,24],'208':[0],'210':[0,2],'212':[3],'213':[49]
        # ,'214':[7,9,10,14,15,40],'220':[10,55],'221':[2,5],'231':[1,3,6,10,12],'232':[1],'233':[35,40],'244':[0,1,2,3,5,6,7],'249':[0],'264':[3,12,13,35,51,61,63],'269':[2,4,9,11,35],'274':[5,8,9,12,16,26,31,47,11,69]
        # ,'285':[0,5,7,8,9,10,12,13,14],'286':[123],'287':[0,1],'294':[5],'295':[120],'296':[36,88,42,47,33,12,69,60],'307':[3,5,10,17,27,32,12,55],'312':[63,68],'317':[4,6],'327':[3],'332':[1,4]
        # ,'337':[0],'370':[10],'370':[31,35,36,61,63,82],'371':[12,26,14,15],'372':[0,2,7,9,10,12,16,17,22,26],'373':[3],'374':[8,15,16,17],'375':[4],'376':[0,1],'377':[6,7],'380':[2,5,8,16,20,35],'381':[32,43,29]
        # ,'382':[71,34,39,79],'385':[0],'386':[3,13,14,15,16],'388':[1],'389':[3],'391':[7,25,0,5,9,10,12,17,19],'392':[0,3,7,14,25,28],'393':[4,6],'394':[5,26,20,43],'395':[4],'396':[7,14,0,9,4],'397':[2,4],'398':[2]
        # ,'401':[0,1,2,4,6,7,10,20,58,21,4,58],'402':[0,1,4,6,7,12,14,15,16,18,20,21,24,25,28],'403':[1],'404':[6],'405':[4,14],'406':[1,2,9,33],'407':[3],'408':[2],'457':[0],'459':[12,33],'461':[2]
        # ,'471':[12],'472':[6]}
# errors={'4':[1,2,11,12,13,14],'5':[64],'7':[6,7,10],'8':[0,2],'13':[11],'21':[65],'30':[152],'41':[136],'47':[29],'51':[3,9],'53':[5],'60':[13],'62':[73,74,75],'79':[0,1],'86':[45],'122':[66],'124':[0]
        # ,'129':[0,1,2],'138':[94],'140':[88],'157':[80],'163':[66],'183':[52],'197':[15],'199':[43],'208':[0],'214':[0],'239':[53],'244':[12,13,14],'249':[3],'259':[0],'264':[0,6],'285':[1,2],'287':[0,7]
        # ,'294':[1,3],'295':[10],'296':[25],'317':[12],'322':[10],'332':[2,13],'337':[18,25,26,32,36],'389':[0,74],'392':[4],'396':[1],'397':[4],'408':[0],'409':[57,58],'457':[7],'458':[0,1],'459':[89,90]
        # ,'460':[1,2],'462':[9],'469':[36],'471':[60,63],'473':[60]}
# orb_kp_path="/data/wxy/association/Maskflownet_association_1024/kps/recursive_DLFSFG_ite2_kps_1024_with_ORB16s8_1024_0.972_0.92/"
# errors={'4':[3,11,12,17,18,19],'5':[1,10,11,16,17,41,42],'6':[12,21],'7':[6,7,18,20,22],'8':[31],'13':[19],'20':[9],'21':[4,15,16],'22':[1],'27':[33,56],'30':[3],'33':[18],'40':[44],'41':[17,21,39,75]
        # ,'42':[10,20,49,65],'47':[32],'51':[10,21,28,29,32,44,70,93],'52':[72],'53':[6,109],'60':[28,41,68,73,76,78,100],'61':[74],'62':[46,47,49,51,67,86],'73':[85],'79':[0,1,2,5,13,22,31,32],'84':[0,110]
        # ,'85':[6],'86':[47,50,87],'87':[63,72],'88':[36,44,49,53,54,86],'93':[56,79,93],'105':[0,2],'106':[3,8,43,53],'111':[4,5,8,30,32,33],'120':[2,5],'121':[40,76,73],'122':[15,29],'123':[0,2,7,11,13,19,20]
        # ,'124':[2,5,6,7,19,20,21],'129':[3,6,38,39],'138':[15,44],'139':[21],'147':[7],'155':[0,33],'156':[0,6,30,61],'157':[3,6,26],'163':[9,42,34],'168':[0,2,3,51],'173':[76],'181':[12,20,32],'182':[27,35,36,37]
        # ,'199':[28,40],'210':[11],'211':[12,17],'220':[41,51],'231':[1,7],'232':[0,17,34],'244':[0,1,5,12,13,15,17,18,19,20],'259':[0,1,2,4,5,6,7],'264':[2,13,14],'274':[2],'279':[28],'285':[0,2,3,4,9,11,13,15,20,21]
        # ,'286':[4],'287':[2,5,7,8,9,10,11,12,17,19,25,26,28],'296':[2],'302':[0],'307':[49],'312':[0,1],'317':[0,18,24,26],'322':[4],'332':[4],'337':[0,9,11,12,15],'373':[0,1,2,11,13],'376':[17,18]
        # ,'379':[20],'381':[5],'386':[29],'388':[11,17],'392':[59],'393':[0,1,6],'395':[10],'396':[20],'397':[8],'398':[1],'399':[1,3],'401':[1,25],'402':[30],'403':[14],'404':[141],'426':[16,17]
        # ,'428':[1],'456':[0],'457':[1],'458':[0,1,2],'459':[18],'460':[14],'461':[9,10],'462':[0,18]}

# orb_kp_path="/data/wxy/association/Maskflownet_association_1024/kps/recursive_DLFSFG_ite3_kps_1024_with_ORB16s8_1024_0.972_0.92/"
# errors={'4':[3,4,5],'5':[10,11],'7':[3,4],'8':[0,2],'13':[3],'21':[23],'30':[25],'33':[4],'41':[42],'52':[47],'53':[68],'62':[21,36,37],'72':[45],'79':[0,1,2],'86':[12,14],'87':[27]
        # ,'88':[29],'102':[12,13,14],'121':[1],'122':[20],'123':[3,4],'124':[0],'138':[30],'141':[32,40,41],'155':[10,13,25,26],'163':[10,13,24],'181':[3],'184':[8],'189':[23]
        # ,'208':[0,2],'210':[11],'212':[0],'213':[38],'214':[0,1,2,12,15,16],'220':[15,22],'221':[5,14,15,35],'231':[1],'233':[0,19,20,29],'239':[27],'244':[5,6],'249':[1],'259':[1]
        # ,'264':[0],'269':[28],'285':[0,5],'286':[18,62,67],'294':[1,11,13],'295':[1],'296':[20],'317':[3],'322':[2,3],'332':[2],'337':[1,3,5,6],'370':[5],'371':[11],'378':[0],'389':[0]
        # ,'392':[1],'396':[1],'397':[2],'407':[2],'409':[11],'456':[0,4],'457':[3],'458':[0,1],'459':[10],'460':[1,2],'469':[7],'471':[12]}

# orb_kp_path="/data/wxy/association/Maskflownet_association_1024/kps/recursive_DLFSFG_ite3_kps_1024_with_ORB16s8_1024_0.972_0.92_2/"
# errors={'4':[1,3,4,5],'5':[5,17,18],'7':[4,6,7],'8':[1,3,14],'19':[15],'20':[8],'27':[28],'30':[30],'33':[12],'38':[28],'41':[54],'52':[56],'53':[46],'62':[30,32,33,50,51],'71':[39]
        # ,'72':[48,49,50],'79':[0,1,2,3],'86':[19],'87':[25],'88':[30,32,33],'102':[19,20,21,22,23],'106':[6],'121':[1,16],'122':[22],'123':[0,1,7,8,9,10],'124':[0,1],'138':[20,35]
        # ,'141':[47,56],'155':[25],'156':[3],'157':[0],'163':[0],'168':[1],'180':[8,11],'180':[33],'181':[13],'182':[12,20],'183':[17],'184':[12],'189':[11],'198':[4],'208':[0],'209':[29]
        # ,'211':[25],'214':[0,1,2,18,24],'220':[14],'221':[29],'231':[2],'233':[0,1],'239':[24],'244':[0,1,9,10],'249':[2],'259':[1,2],'285':[5,7,8,9,10,11,12],'286':[2],'287':[2,8],'294':[13]
        # ,'295':[4],'296':[34],'312':[0],'317':[2,6],'322':[1],'327':[4],'332':[0,4],'337':[2,5],'377':[1],'389':[0],'392':[2],'396':[1],'397':[10],'398':[2],'399':[14],'406':[0,7],'409':[13]
        # ,'456':[2,6],'457':[2],'458':[1],'459':[0,22],'460':[0,2],'462':[5],'469':[7],'471':[1,2]}
# orb_kp_path="/data/wxy/association/Maskflownet_association_1024/kps/LFS_SFG_multiscale_kps_1024_with_ORB16s8_1024_0.972_0.92/"
# errors={'52':[140],'141':[267,268,270]}
# orb_kp_path="/data/wxy/association/Maskflownet_association_1024/kps/recursive_DLFSFG_ite2_kps_1024_with_ORB16s8_1024_0.972_0.92/"
# errors={'123':[7]}
# orb_kp_path="/data/wxy/association/Maskflownet_association_1024/kps/recursive_DLFSFG_ite3_kps_1024_with_ORB16s8_1024_0.972_0.92/"
# errors={'285':[5]}
# orb_kp_path="/data/wxy/Pixel-Level-Cycle-Association-main/output/kps_resnet/vgg16_features_ORB16s8_fc6_20_0.2_30_0.2_40_0.2_50_0.2_60_0.2_rotate8_0.99_0.028_0.004_0.8_01norm_same_pixels_multiscale_1024/"
# errors={'287':[9,10,11,12,14,17,18],'392':[67,68,75],'393':[51],'401':[44,55,35,59,67,72,80,91],'406':[8,19,24,36,65,88,267,240]}
def LoadANHIR(data_path = r"/data/wxy/Pixel-Level-Cycle-Association-main/data/"):##"/data3/gl/wxy_data/"
    count=-1
    with open(os.path.join(data_path, "matrix_sequence_manual_validation.csv"), newline="") as f:
        reader = csv.reader(f)
        for row in reader:
            if reader.line_num == 1:
                continue
            num = int(row[0])
            # if num>=7:
                # continue
            if row[5] == 'training':
                count=count+1
                if str(num) not in errors:
                    continue
                delete_index=errors[str(num)]
                delete_index.sort(key=lambda x:int(x))
                delete1=[]
                delete2=[]
                
                print('num={}'.format(num))
                fimg = str(num)+'_1.jpg'
                flmk = str(num)+'_1.csv'
                fkp=str(num)+'_1'
                lmk1_orb = pd.read_csv(orb_kp_path+flmk)
                
                lmk1_orb = np.array(lmk1_orb)
                lmk1_orb = lmk1_orb[:, [2, 1]].tolist()
                

                fimg = str(num) + '_2.jpg'
                flmk = str(num) + '_2.csv'
                fkp=str(num)+'_2'
                lmk2_orb = pd.read_csv(orb_kp_path+flmk)
                lmk2_orb = np.array(lmk2_orb)
                lmk2_orb = lmk2_orb[:, [2, 1]].tolist()
                # for i in range (len(delete_index)):
                    # delete1.append(lmk1_orb[delete_index[i]])
                    # delete2.append(lmk2_orb[delete_index[i]])
                # pdb.set_trace()
                for i in range(len(delete_index)):
                    lmk1_orb.pop(delete_index[i]-i)
                    lmk2_orb.pop(delete_index[i]-i)
                    # lmk1_orb.remove(delete1[i])#####
                    # lmk2_orb.remove(delete2[i])#####
                if len(lmk1_orb)==0 or len(lmk2_orb)==0:
                    os.remove(orb_kp_path+str(num)+'_1.csv')
                    os.remove(orb_kp_path+str(num)+'_2.csv')
                else:
                    name = ['X', 'Y']
                    lmk1=np.asarray(lmk1_orb)
                    lmk1=lmk1[:,[1,0]]
                    lmk2=np.asarray(lmk2_orb)
                    lmk2=lmk2[:,[1,0]]
                    outlmk1 = pd.DataFrame(columns=name, data=lmk1)
                    outlmk1.to_csv(orb_kp_path+str(num)+'_1.csv')
                    outlmk2 = pd.DataFrame(columns=name, data=lmk2)
                    outlmk2.to_csv(orb_kp_path+str(num)+'_2.csv')
    return 0
if __name__ == '__main__':
    _=LoadANHIR()